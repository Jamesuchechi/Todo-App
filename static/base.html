<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ultimate Todo Manager 2.0</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc',
              400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1',
              800: '#075985', 900: '#0c4a6e',
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-in': 'slideIn 0.3s ease-out',
            'bounce-in': 'bounceIn 0.6s ease-out',
            'pulse-soft': 'pulseSoft 2s infinite',
            'shake': 'shake 0.5s ease-in-out',
            'timer-pulse': 'timerPulse 1s infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' }
            },
            slideIn: {
              '0%': { transform: 'translateY(-10px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            },
            bounceIn: {
              '0%': { transform: 'scale(0.3)', opacity: '0' },
              '50%': { transform: 'scale(1.05)' },
              '70%': { transform: 'scale(0.9)' },
              '100%': { transform: 'scale(1)', opacity: '1' }
            },
            pulseSoft: {
              '0%, 100%': { opacity: '1' },
              '50%': { opacity: '0.8' }
            },
            shake: {
              '0%, 100%': { transform: 'translateX(0)' },
              '10%, 30%, 50%, 70%, 90%': { transform: 'translateX(-5px)' },
              '20%, 40%, 60%, 80%': { transform: 'translateX(5px)' }
            },
            timerPulse: {
              '0%, 100%': { transform: 'scale(1)', opacity: '1' },
              '50%': { transform: 'scale(1.05)', opacity: '0.9' }
            }
          }
        }
      }
    }
  </script>
  <style>
    .task-card {
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
    }
    .task-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    .priority-low { border-left-color: #10b981; }
    .priority-medium { border-left-color: #f59e0b; }
    .priority-high { border-left-color: #f97316; }
    .priority-urgent { border-left-color: #ef4444; }
    .status-pending { background-color: #fef3c7; color: #d97706; }
    .status-in_progress { background-color: #dbeafe; color: #1d4ed8; }
    .status-completed { background-color: #d1fae5; color: #065f46; }
    .dark .status-pending { background-color: #78350f; color: #fef3c7; }
    .dark .status-in_progress { background-color: #1e3a8a; color: #dbeafe; }
    .dark .status-completed { background-color: #064e3b; color: #d1fae5; }
    .hover-lift { transition: all 0.3s ease; }
    .hover-lift:hover { transform: translateY(-3px); }
    .checkbox-custom {
      appearance: none;
      width: 20px;
      height: 20px;
      border: 2px solid #d1d5db;
      border-radius: 4px;
      outline: none;
      cursor: pointer;
      position: relative;
      transition: all 0.2s ease;
    }
    .checkbox-custom:checked {
      background-color: #10b981;
      border-color: #10b981;
    }
    .checkbox-custom:checked:before {
      content: '‚úì';
      position: absolute;
      color: white;
      font-size: 14px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 50;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      animation: fadeIn 0.3s;
    }
    .modal.active { display: flex; }
    .modal-content {
      margin: auto;
      max-width: 800px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      animation: slideIn 0.3s;
    }
    .dark { background: #0f172a; color: #f1f5f9; }
    .dark .bg-white { background: #1e293b; }
    .dark .text-gray-800 { color: #f1f5f9; }
    .dark .text-gray-600 { color: #cbd5e1; }
    .dark .border-gray-300 { border-color: #475569; }
    .glass-effect {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }
    .dark .glass-effect {
      background: rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen p-4" x-data="todoApp()" x-init="init()" :class="darkMode ? 'dark' : ''">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="glass-effect rounded-2xl shadow-xl p-6 mb-6 animate-fade-in">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4">
        <div>
          <h1 class="text-3xl font-bold bg-gradient-to-r from-primary-600 to-purple-600 bg-clip-text text-transparent">
            <i class="fas fa-tasks mr-2"></i>Ultimate Todo Manager 2.0
          </h1>
          <p class="text-gray-600 dark:text-gray-400 mt-1">Advanced productivity with time tracking & analytics</p>
        </div>
        
        <div class="flex gap-2 flex-wrap">
          <button @click="darkMode = !darkMode" 
                  class="flex items-center gap-2 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg transition-all duration-300 hover-lift shadow-sm">
            <i class="fas" :class="darkMode ? 'fa-sun' : 'fa-moon'"></i>
            <span x-text="darkMode ? 'Light' : 'Dark'"></span>
          </button>
          
          <button @click="showStats = !showStats" 
                  class="flex items-center gap-2 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg transition-all duration-300 hover-lift shadow-sm">
            <i class="fas fa-chart-bar"></i>
            <span x-text="showStats ? 'Hide Stats' : 'Show Stats'"></span>
          </button>
          
          <button @click="showTemplates = true" 
                  class="flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all duration-300 hover-lift shadow-sm">
            <i class="fas fa-file-alt"></i>
            Templates
          </button>
          
          <button @click="view = view === 'list' ? 'kanban' : 'list'" 
                  class="flex items-center gap-2 bg-primary-500 hover:bg-primary-600 text-white px-4 py-2 rounded-lg transition-all duration-300 hover-lift shadow-sm">
            <i class="fas" :class="view === 'list' ? 'fa-columns' : 'fa-list'"></i>
            <span x-text="view === 'list' ? 'Kanban' : 'List'"></span>
          </button>
        </div>
      </div>
      
      <!-- Stats Panel -->
      <div x-show="showStats" x-collapse 
           class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4 mt-6 animate-slide-in">
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 hover-lift">
          <div class="text-2xl font-bold text-primary-600" x-text="stats.total || 0"></div>
          <div class="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1">
            <i class="fas fa-tasks"></i> Total
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 hover-lift">
          <div class="text-2xl font-bold text-green-600" x-text="stats.completed || 0"></div>
          <div class="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1">
            <i class="fas fa-check-circle"></i> Done
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 hover-lift">
          <div class="text-2xl font-bold text-yellow-600" x-text="stats.pending || 0"></div>
          <div class="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1">
            <i class="fas fa-clock"></i> Pending
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 hover-lift">
          <div class="text-2xl font-bold text-blue-600" x-text="stats.in_progress || 0"></div>
          <div class="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1">
            <i class="fas fa-spinner"></i> Active
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 hover-lift">
          <div class="text-2xl font-bold text-red-600" x-text="stats.overdue || 0"></div>
          <div class="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1">
            <i class="fas fa-exclamation-triangle"></i> Overdue
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 hover-lift">
          <div class="text-2xl font-bold text-purple-600" x-text="`${stats.completion_rate || 0}%`"></div>
          <div class="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1">
            <i class="fas fa-chart-line"></i> Rate
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 hover-lift">
          <div class="text-2xl font-bold text-orange-600" x-text="stats.streak_days || 0"></div>
          <div class="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1">
            <i class="fas fa-fire"></i> Streak
          </div>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      <!-- Left Panel -->
      <div class="lg:col-span-1 space-y-6">
        <!-- Add Task Card -->
        <div class="glass-effect rounded-2xl shadow-xl p-6 animate-fade-in">
          <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-100 flex items-center gap-2">
            <i class="fas fa-plus-circle text-primary-500"></i>
            <span>Add New Task</span>
          </h2>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Title *</label>
              <input x-model="newTodo.title" placeholder="What needs to be done?" 
                     class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-400">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
              <textarea x-model="newTodo.description" placeholder="Add details..." 
                        class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-400 h-24"></textarea>
            </div>
            
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Priority</label>
                <select x-model="newTodo.priority" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-400">
                  <option value="low">üü¢ Low</option>
                  <option value="medium" selected>üü° Medium</option>
                  <option value="high">üü† High</option>
                  <option value="urgent">üî¥ Urgent</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Status</label>
                <select x-model="newTodo.status" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-400">
                  <option value="pending">‚è≥ Pending</option>
                  <option value="in_progress">üîÑ In Progress</option>
                  <option value="completed">‚úÖ Completed</option>
                </select>
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Due Date</label>
              <input type="datetime-local" x-model="newTodo.due_date" 
                     class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-400">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
              <select x-model="newTodo.category_id" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-400">
                <option value="">No Category</option>
                <template x-for="category in categories" :key="category.id">
                  <option :value="category.id" x-text="category.name"></option>
                </template>
              </select>
            </div>
            
            <button @click="addTodo" 
                    class="w-full bg-gradient-to-r from-primary-500 to-purple-500 hover:from-primary-600 hover:to-purple-600 text-white rounded-lg px-4 py-3 font-semibold transition-all duration-300 hover-lift shadow-md flex items-center justify-center gap-2">
              <i class="fas fa-plus"></i>
              Add Task
            </button>
          </div>
        </div>

        <!-- Timer & Pomodoro Card -->
        <div class="glass-effect rounded-2xl shadow-xl p-6 animate-fade-in">
          <h3 class="text-lg font-bold mb-4 text-gray-800 dark:text-gray-100 flex items-center gap-2">
            <i class="fas fa-stopwatch text-red-500"></i>
            <span>Timer & Pomodoro</span>
          </h3>
          
          <div x-show="activeTimer.todo_id" class="space-y-4">
            <div class="text-center">
              <div class="text-5xl font-bold text-primary-600 animate-timer-pulse mb-2 font-mono" 
                   x-text="formatTimerDisplay(activeTimer.elapsed_seconds)"></div>
              <p class="text-sm text-gray-600 dark:text-gray-400 mb-1" x-text="'Working on: ' + (activeTimer.title || 'Task')"></p>
              <p class="text-xs text-gray-500 dark:text-gray-500">
                Pomodoros: <span class="font-bold" x-text="activeTimer.pomodoro_count || 0"></span>
                <span x-show="activeTimer.pomodoro_target"> / <span x-text="activeTimer.pomodoro_target"></span></span>
              </p>
            </div>
            
            <div class="grid grid-cols-2 gap-2">
              <button @click="stopTimer(activeTimer.todo_id)" 
                      class="bg-red-500 hover:bg-red-600 text-white rounded-lg p-3 transition-all duration-300 hover-lift flex items-center justify-center gap-2">
                <i class="fas fa-stop"></i>
                Stop
              </button>
              <button @click="completePomodoro(activeTimer.todo_id)" 
                      class="bg-green-500 hover:bg-green-600 text-white rounded-lg p-3 transition-all duration-300 hover-lift flex items-center justify-center gap-2">
                <i class="fas fa-check"></i>
                Complete üçÖ
              </button>
            </div>
          </div>
          
          <div x-show="!activeTimer.todo_id" class="text-center text-gray-500 dark:text-gray-400 py-8">
            <i class="fas fa-clock text-4xl mb-2"></i>
            <p class="font-medium">No active timer</p>
            <p class="text-xs mt-1">Click "Start Timer" on any task to begin</p>
          </div>
        </div>

        <!-- Category Management -->
        <div class="glass-effect rounded-2xl shadow-xl p-6 animate-fade-in">
          <h3 class="text-lg font-bold mb-4 text-gray-800 dark:text-gray-100 flex items-center gap-2">
            <i class="fas fa-folder text-yellow-500"></i>
            <span>Categories</span>
          </h3>
          
          <div class="space-y-3 mb-4 max-h-40 overflow-y-auto">
            <template x-for="category in categories" :key="category.id">
              <div class="flex items-center justify-between bg-white dark:bg-gray-800 rounded-lg p-2 border border-gray-200 dark:border-gray-700">
                <div class="flex items-center gap-2">
                  <div class="w-4 h-4 rounded-full" :style="`background-color: ${category.color}`"></div>
                  <span class="text-sm" x-text="category.name"></span>
                </div>
                <button @click="deleteCategory(category.id)" 
                        class="text-red-500 hover:text-red-700 p-1 rounded hover:bg-red-50 dark:hover:bg-red-900/20">
                  <i class="fas fa-trash text-xs"></i>
                </button>
              </div>
            </template>
            
            <div x-show="categories.length === 0" class="text-center text-gray-400 dark:text-gray-500 py-2 text-sm">
              No categories yet
            </div>
          </div>
          
          <div class="flex gap-2">
            <input x-model="newCategoryName" 
                   @keyup.enter="addCategory"
                   placeholder="New category" 
                   class="flex-1 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-400">
            <button @click="addCategory" 
                    class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 rounded-lg text-sm font-medium transition-all duration-300 hover-lift">
              <i class="fas fa-plus"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="lg:col-span-3">
        <!-- Filters Card -->
        <div class="glass-effect rounded-2xl shadow-xl p-6 mb-6 animate-fade-in">
          <div class="flex flex-col md:flex-row gap-4 justify-between items-start md:items-center">
            <div class="flex-1 w-full md:w-auto">
              <div class="relative">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                <input x-model="filters.search" @input="debouncedFetchTodos" placeholder="Search tasks..." 
                       class="w-full pl-10 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-400">
              </div>
            </div>

            <div class="flex gap-2 flex-wrap">
              <select x-model="filters.status" @change="fetchTodos" 
                      class="border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-400">
                <option value="">All Status</option>
                <option value="pending">Pending</option>
                <option value="in_progress">In Progress</option>
                <option value="completed">Completed</option>
              </select>
              
              <select x-model="filters.priority" @change="fetchTodos" 
                      class="border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-400">
                <option value="">All Priorities</option>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
                <option value="urgent">Urgent</option>
              </select>
            </div>
          </div>
        </div>

        <!-- List View -->
        <div class="glass-effect rounded-2xl shadow-xl p-6 animate-fade-in">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2">
              <i class="fas fa-list-ul text-primary-500"></i>
              <span>Your Tasks</span>
            </h2>
            <span class="text-sm text-gray-500 dark:text-gray-400" x-text="`${todos.length} tasks`"></span>
          </div>

          <div class="space-y-4 max-h-[700px] overflow-y-auto pr-2">
            <template x-if="todos.length === 0">
              <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                <div class="text-6xl mb-4">üìù</div>
                <p class="text-lg">No tasks found. Create one to get started!</p>
              </div>
            </template>

            <template x-for="todo in todos" :key="todo.id">
              <div class="task-card bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700"
                   :class="`priority-${todo.priority}`">
                <div class="flex items-start gap-4">
                  <input type="checkbox" 
                         :checked="todo.status === 'completed'" 
                         @change="toggleStatus(todo)" 
                         class="checkbox-custom mt-1">
                  
                  <div class="flex-1 min-w-0">
                    <div class="flex flex-wrap items-center gap-2 mb-2">
                      <h3 class="font-semibold text-lg flex-1" 
                          :class="todo.status === 'completed' ? 'line-through text-gray-500' : 'text-gray-800 dark:text-gray-100'"
                          x-text="todo.title"></h3>
                      
                      <span class="px-2 py-1 rounded-full text-xs font-medium capitalize"
                            :class="{
                              'status-pending': todo.status === 'pending',
                              'status-in_progress': todo.status === 'in_progress',
                              'status-completed': todo.status === 'completed'
                            }"
                            x-text="todo.status.replace('_', ' ')"></span>
                    </div>
                    
                    <p x-show="todo.description" 
                       class="text-sm text-gray-600 dark:text-gray-400 mb-3" 
                       x-text="todo.description"></p>
                    
                    <!-- Meta Information -->
                    <div class="flex flex-wrap gap-2 text-xs mb-3">
                      <span class="px-2 py-1 rounded-full flex items-center gap-1"
                            :class="{
                              'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300': todo.priority === 'low',
                              'bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300': todo.priority === 'medium',
                              'bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300': todo.priority === 'high',
                              'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300': todo.priority === 'urgent'
                            }">
                        <i class="fas fa-flag"></i>
                        <span x-text="todo.priority" class="capitalize"></span>
                      </span>
                      
                      <span x-show="todo.due_date" 
                            class="px-2 py-1 rounded-full flex items-center gap-1 bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300">
                        <i class="fas fa-calendar"></i>
                        <span x-text="formatDate(todo.due_date)"></span>
                      </span>
                      
                      <span x-show="todo.category" 
                            class="px-2 py-1 bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 rounded-full flex items-center gap-1">
                        <i class="fas fa-folder"></i>
                        <span x-text="todo.category.name"></span>
                      </span>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex gap-2 flex-wrap">
                      <button @click="startTimer(todo)" 
                              x-show="!todo.timer_started_at && todo.status !== 'completed'"
                              class="text-xs bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg transition-all duration-300 flex items-center gap-1">
                        <i class="fas fa-play"></i> Start Timer
                      </button>
                      
                      <button @click="stopTimer(todo.id)" 
                              x-show="todo.timer_started_at"
                              class="text-xs bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg transition-all duration-300 flex items-center gap-1 animate-pulse">
                        <i class="fas fa-stop"></i> Stop Timer
                      </button>
                      
                      <button @click="makeTemplate(todo)" 
                              class="text-xs bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded-lg transition-all duration-300 flex items-center gap-1">
                        <i class="fas fa-save"></i> Save as Template
                      </button>
                      
                      <button @click="editTodo(todo)" 
                              class="text-xs bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg transition-all duration-300 flex items-center gap-1">
                        <i class="fas fa-edit"></i> Edit
                      </button>
                    </div>
                  </div>
                  
                  <!-- Delete Icon -->
                  <div>
                    <button @click="deleteTodo(todo.id)" 
                            class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 p-2 rounded-full hover:bg-red-50 dark:hover:bg-red-900/20 transition-all duration-300">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Templates Modal -->
  <div class="modal" :class="showTemplates ? 'active' : ''" @click.self="showTemplates = false">
    <div class="modal-content glass-effect rounded-2xl p-6">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-100">
          <i class="fas fa-file-alt text-green-500 mr-2"></i>
          Task Templates
        </h2>
        <button @click="showTemplates = false" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
          <i class="fas fa-times text-2xl"></i>
        </button>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <template x-for="template in templates" :key="template.id">
          <div class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all duration-300">
            <h3 class="font-bold text-lg mb-2 text-gray-800 dark:text-gray-100" x-text="template.template_name"></h3>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3" x-text="template.description || 'No description'"></p>
            <div class="flex gap-2 mb-3">
              <span class="text-xs px-2 py-1 bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-300 rounded-full capitalize" 
                    x-text="template.priority"></span>
              <span x-show="template.estimated_duration" 
                    class="text-xs px-2 py-1 bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300 rounded-full" 
                    x-text="`${template.estimated_duration} min`"></span>
            </div>
            <button @click="createFromTemplate(template.id)" 
                    class="w-full bg-green-500 hover:bg-green-600 text-white rounded-lg py-2 transition-all duration-300">
              <i class="fas fa-plus mr-2"></i>Create from Template
            </button>
          </div>
        </template>
        
        <div x-show="templates.length === 0" class="col-span-2 text-center py-12 text-gray-500 dark:text-gray-400">
          <i class="fas fa-inbox text-4xl mb-2"></i>
          <p>No templates yet. Save a task as template to get started!</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Todo Modal -->
  <div class="modal" :class="showEditModal ? 'active' : ''" @click.self="showEditModal = false">
    <div class="modal-content glass-effect rounded-2xl p-6 max-w-2xl">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-100">
          <i class="fas fa-edit text-blue-500 mr-2"></i>
          Edit Task
        </h2>
        <button @click="showEditModal = false" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
          <i class="fas fa-times text-2xl"></i>
        </button>
      </div>
      
      <div class="space-y-4" x-show="editingTodo">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Title *</label>
          <input x-model="editingTodo.title" 
                 class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-400">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
          <textarea x-model="editingTodo.description" 
                    class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-400 h-24"></textarea>
        </div>
        
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Priority</label>
            <select x-model="editingTodo.priority" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-400">
              <option value="low">üü¢ Low</option>
              <option value="medium">üü° Medium</option>
              <option value="high">üü† High</option>
              <option value="urgent">üî¥ Urgent</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Status</label>
            <select x-model="editingTodo.status" class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-400">
              <option value="pending">‚è≥ Pending</option>
              <option value="in_progress">üîÑ In Progress</option>
              <option value="completed">‚úÖ Completed</option>
            </select>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Due Date</label>
          <input type="datetime-local" x-model="editingTodo.due_date" 
                 class="w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-400">
        </div>
        
        <div class="flex gap-4">
          <button @click="updateTodo" 
                  class="flex-1 bg-blue-500 hover:bg-blue-600 text-white rounded-lg px-4 py-3 font-semibold transition-all duration-300 hover-lift">
            Update Task
          </button>
          <button @click="showEditModal = false" 
                  class="flex-1 bg-gray-500 hover:bg-gray-600 text-white rounded-lg px-4 py-3 font-semibold transition-all duration-300 hover-lift">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function todoApp() {
        return {
            todos: [],
            templates: [],
            categories: [],
            stats: {},
            newTodo: {
                title: '',
                description: '',
                priority: 'medium',
                status: 'pending',
                due_date: '',
                category_id: null
            },
            filters: {
                search: '',
                status: '',
                priority: '',
                sort_by: 'created_at',
                sort_order: 'desc'
            },
            showStats: true,
            showTemplates: false,
            showEditModal: false,
            darkMode: false,
            view: 'list',
            apiUrl: '/todos/',
            debounceTimer: null,
            activeTimer: {
                todo_id: null,
                elapsed_seconds: 0,
                title: '',
                pomodoro_count: 0,
                pomodoro_target: null
            },
            timerInterval: null,
            editingTodo: null,
            newCategoryName: '',

            async init() {
                await this.fetchTodos();
                await this.fetchStats();
                await this.fetchTemplates();
                await this.fetchCategories();
                this.loadDarkMode();
                this.startTimerSync();
                setInterval(() => this.fetchStats(), 30000);
            },

            loadDarkMode() {
                const saved = localStorage.getItem('darkMode');
                this.darkMode = saved === 'true';
            },

            async fetchTodos() {
                try {
                    const params = new URLSearchParams();
                    if (this.filters.search) params.append('search', this.filters.search);
                    if (this.filters.status) params.append('status', this.filters.status);
                    if (this.filters.priority) params.append('priority', this.filters.priority);
                    params.append('sort_by', this.filters.sort_by);
                    params.append('sort_order', this.filters.sort_order);

                    const res = await fetch(`${this.apiUrl}?${params}`);
                    if (res.ok) {
                        this.todos = await res.json();
                    }
                } catch (error) {
                    console.error('Error fetching todos:', error);
                }
            },

            debouncedFetchTodos() {
                clearTimeout(this.debounceTimer);
                this.debounceTimer = setTimeout(() => this.fetchTodos(), 300);
            },

            async fetchStats() {
                try {
                    const res = await fetch(`${this.apiUrl}stats/`);
                    if (res.ok) {
                        this.stats = await res.json();
                    }
                } catch (error) {
                    console.error('Error fetching stats:', error);
                }
            },

            async fetchTemplates() {
                try {
                    const res = await fetch(`${this.apiUrl}templates/list`);
                    if (res.ok) {
                        this.templates = await res.json();
                    }
                } catch (error) {
                    console.error('Error fetching templates:', error);
                }
            },

            async fetchCategories() {
                try {
                    const res = await fetch(`${this.apiUrl}categories/`);
                    if (res.ok) {
                        this.categories = await res.json();
                    }
                } catch (error) {
                    console.error('Error fetching categories:', error);
                }
            },

            async addTodo() {
                if (!this.newTodo.title.trim()) {
                    this.showNotification('Please enter a task title', 'error');
                    return;
                }
                
                try {
                    const todoData = { ...this.newTodo };
                    if (!todoData.due_date) delete todoData.due_date;
                    if (!todoData.category_id) delete todoData.category_id;

                    const response = await fetch(this.apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(todoData)
                    });

                    if (response.ok) {
                        this.newTodo = {
                            title: '',
                            description: '',
                            priority: 'medium',
                            status: 'pending',
                            due_date: '',
                            category_id: null
                        };
                        
                        await this.fetchTodos();
                        await this.fetchStats();
                        this.showNotification('Task added successfully!', 'success');
                    } else {
                        const error = await response.json();
                        this.showNotification('Error adding task: ' + (error.detail || 'Unknown error'), 'error');
                    }
                } catch (error) {
                    console.error('Error adding todo:', error);
                    this.showNotification('Error adding task', 'error');
                }
            },

            async toggleStatus(todo) {
                const newStatus = todo.status === 'completed' ? 'pending' : 'completed';
                
                try {
                    const response = await fetch(`${this.apiUrl}${todo.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ status: newStatus })
                    });

                    if (response.ok) {
                        await this.fetchTodos();
                        await this.fetchStats();
                        this.showNotification(newStatus === 'completed' ? 'Task completed! üéâ' : 'Task reopened', 'success');
                    }
                } catch (error) {
                    console.error('Error updating todo:', error);
                }
            },

            async deleteTodo(id) {
                if (!confirm('Are you sure you want to delete this task?')) return;
                
                try {
                    const response = await fetch(`${this.apiUrl}${id}`, { method: 'DELETE' });
                    if (response.ok) {
                        await this.fetchTodos();
                        await this.fetchStats();
                        this.showNotification('Task deleted!', 'success');
                    }
                } catch (error) {
                    console.error('Error deleting todo:', error);
                }
            },

            async editTodo(todo) {
                this.editingTodo = { 
                    ...todo,
                    due_date: todo.due_date ? new Date(todo.due_date).toISOString().slice(0, 16) : ''
                };
                this.showEditModal = true;
            },

            async updateTodo() {
                if (!this.editingTodo.title.trim()) {
                    this.showNotification('Please enter a task title', 'error');
                    return;
                }
                
                try {
                    const response = await fetch(`${this.apiUrl}${this.editingTodo.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.editingTodo)
                    });

                    if (response.ok) {
                        this.showEditModal = false;
                        await this.fetchTodos();
                        await this.fetchStats();
                        this.showNotification('Task updated successfully!', 'success');
                    }
                } catch (error) {
                    console.error('Error updating todo:', error);
                    this.showNotification('Error updating task', 'error');
                }
            },

            // Timer Functions
            async startTimer(todo) {
                try {
                    const response = await fetch(`${this.apiUrl}${todo.id}/timer/start`, {
                        method: 'POST'
                    });

                    if (response.ok) {
                        this.activeTimer = {
                            todo_id: todo.id,
                            elapsed_seconds: 0,
                            title: todo.title,
                            pomodoro_count: todo.pomodoro_count || 0,
                            pomodoro_target: todo.pomodoro_target
                        };
                        this.startTimerInterval();
                        await this.fetchTodos();
                        this.showNotification('Timer started! ‚è±Ô∏è', 'success');
                    }
                } catch (error) {
                    console.error('Error starting timer:', error);
                }
            },

            async stopTimer(todoId) {
                try {
                    const response = await fetch(`${this.apiUrl}${todoId}/timer/stop`, {
                        method: 'POST'
                    });

                    if (response.ok) {
                        this.activeTimer = {
                            todo_id: null,
                            elapsed_seconds: 0,
                            title: '',
                            pomodoro_count: 0,
                            pomodoro_target: null
                        };
                        this.stopTimerInterval();
                        await this.fetchTodos();
                        await this.fetchStats();
                        this.showNotification('Timer stopped and time logged! ‚úÖ', 'success');
                    }
                } catch (error) {
                    console.error('Error stopping timer:', error);
                }
            },

            startTimerInterval() {
                if (this.timerInterval) clearInterval(this.timerInterval);
                
                this.timerInterval = setInterval(() => {
                    this.activeTimer.elapsed_seconds++;
                }, 1000);
            },

            stopTimerInterval() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
            },

            async startTimerSync() {
                try {
                    const todos = await fetch(`${this.apiUrl}?limit=1000`);
                    if (todos.ok) {
                        const todosData = await todos.json();
                        const activeTimerTodo = todosData.find(t => t.timer_started_at);
                        
                        if (activeTimerTodo) {
                            const startTime = new Date(activeTimerTodo.timer_started_at);
                            const elapsed = Math.floor((new Date() - startTime) / 1000);
                            
                            this.activeTimer = {
                                todo_id: activeTimerTodo.id,
                                elapsed_seconds: elapsed,
                                title: activeTimerTodo.title,
                                pomodoro_count: activeTimerTodo.pomodoro_count || 0,
                                pomodoro_target: activeTimerTodo.pomodoro_target
                            };
                            this.startTimerInterval();
                        }
                    }
                } catch (error) {
                    console.error('Error syncing timer:', error);
                }
            },

            formatTimerDisplay(seconds) {
                const hrs = Math.floor(seconds / 3600);
                const mins = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                return `${String(hrs).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            },

            async completePomodoro(todoId) {
                try {
                    const response = await fetch(`${this.apiUrl}${todoId}/pomodoro/complete`, {
                        method: 'POST'
                    });

                    if (response.ok) {
                        this.activeTimer.pomodoro_count++;
                        await this.fetchTodos();
                        await this.fetchStats();
                        this.showNotification('üçÖ Pomodoro completed! Great work!', 'success');
                    }
                } catch (error) {
                    console.error('Error completing pomodoro:', error);
                }
            },

            // Template Functions
            async makeTemplate(todo) {
                const templateName = prompt('Enter template name:', `${todo.title} Template`);
                if (!templateName) return;
                
                try {
                    const response = await fetch(`${this.apiUrl}${todo.id}/make-template?template_name=${encodeURIComponent(templateName)}`, {
                        method: 'POST'
                    });

                    if (response.ok) {
                        await this.fetchTemplates();
                        this.showNotification('Template created! üìÑ', 'success');
                    }
                } catch (error) {
                    console.error('Error creating template:', error);
                }
            },

            async createFromTemplate(templateId) {
                try {
                    const response = await fetch(`${this.apiUrl}templates/${templateId}/create`, {
                        method: 'POST'
                    });

                    if (response.ok) {
                        await this.fetchTodos();
                        await this.fetchStats();
                        this.showTemplates = false;
                        this.showNotification('Task created from template! ‚ú®', 'success');
                    }
                } catch (error) {
                    console.error('Error creating from template:', error);
                }
            },

            // Category Management
            async addCategory() {
                if (!this.newCategoryName.trim()) {
                    this.showNotification('Please enter a category name', 'error');
                    return;
                }
                
                try {
                    const response = await fetch(`${this.apiUrl}categories/`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name: this.newCategoryName.trim(),
                            color: '#' + Math.floor(Math.random()*16777215).toString(16)
                        })
                    });

                    if (response.ok) {
                        this.newCategoryName = '';
                        await this.fetchCategories();
                        this.showNotification('Category added! üìÅ', 'success');
                    } else {
                        const error = await response.json();
                        this.showNotification('Error: ' + (error.detail || 'Could not add category'), 'error');
                    }
                } catch (error) {
                    console.error('Error adding category:', error);
                    this.showNotification('Error adding category', 'error');
                }
            },

            async deleteCategory(id) {
                if (!confirm('Delete this category? Tasks in this category will not be deleted.')) return;
                
                try {
                    // Note: You'll need to add a DELETE endpoint for categories in your backend
                    // For now, just refresh the list
                    this.showNotification('Category deletion not implemented yet', 'error');
                } catch (error) {
                    console.error('Error deleting category:', error);
                }
            },

            // Utility Functions
            formatDate(dateStr) {
                if (!dateStr) return '';
                const date = new Date(dateStr);
                const now = new Date();
                const diff = date - now;
                const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
                
                if (days < 0) return '‚ö†Ô∏è Overdue';
                if (days === 0) return 'üìÖ Today';
                if (days === 1) return 'üìÖ Tomorrow';
                return `üìÖ ${date.toLocaleDateString()}`;
            },

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white max-w-sm transform translate-x-full transition-transform duration-300 ${
                    type === 'success' ? 'bg-green-500' : 
                    type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                }`;
                
                notification.innerHTML = `
                    <div class="flex items-center gap-2">
                        <i class="fas ${
                            type === 'success' ? 'fa-check-circle' : 
                            type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'
                        }"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }
        }
    }

    // Watch for dark mode changes
    document.addEventListener('alpine:init', () => {
        Alpine.effect(() => {
            const app = Alpine.store || {};
            if (app.darkMode !== undefined) {
                localStorage.setItem('darkMode', app.darkMode);
            }
        });
    });
  </script>
</body>
</html>